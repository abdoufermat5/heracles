# =============================================================================
# Heracles Demo Environment Configuration
# =============================================================================
# This file contains all configuration variables for the demo environment.
# It is sourced by provisioning scripts and Vagrant.
#
# Usage in scripts:
#   source /vagrant/config/demo.conf
#   # or
#   source "$(dirname "$0")/../config/demo.conf"
# =============================================================================

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
# Host machine IP (VirtualBox host-only network gateway)
HOST_IP="192.168.56.1"

# VM IP addresses
NS1_IP="192.168.56.20"
DHCP1_IP="192.168.56.21"
SERVER1_IP="192.168.56.10"
WORKSTATION1_IP="192.168.56.11"

# Domain
DOMAIN="heracles.local"

# -----------------------------------------------------------------------------
# LDAP Configuration
# -----------------------------------------------------------------------------
# LDAP server (Docker on host)
LDAP_HOST="${HOST_IP}"
LDAP_PORT="636"
LDAP_URI="ldaps://${LDAP_HOST}:${LDAP_PORT}"
LDAP_CA_CERT="/usr/local/share/ca-certificates/heracles-dev-ca.crt"

# LDAP directory structure
LDAP_BASE_DN="dc=heracles,dc=local"
LDAP_USERS_DN="ou=users,${LDAP_BASE_DN}"
LDAP_GROUPS_DN="ou=groups,${LDAP_BASE_DN}"
LDAP_SYSTEMS_DN="ou=systems,${LDAP_BASE_DN}"
LDAP_SUDOERS_DN="ou=sudoers,${LDAP_BASE_DN}"
LDAP_DNS_DN="ou=dns,${LDAP_BASE_DN}"
LDAP_DHCP_DN="ou=dhcp,${LDAP_BASE_DN}"

# LDAP admin credentials
LDAP_ADMIN_DN="cn=admin,${LDAP_BASE_DN}"
LDAP_ADMIN_PASSWORD="admin_secret"

# LDAP bind credentials (same as admin for demo, could be separate)
LDAP_BIND_DN="${LDAP_ADMIN_DN}"
LDAP_BIND_PASSWORD="${LDAP_ADMIN_PASSWORD}"

# -----------------------------------------------------------------------------
# DNS Configuration
# -----------------------------------------------------------------------------
DNS_SERVER="${NS1_IP}"
DNS_FORWARDER="8.8.8.8"
DNS_SEARCH_DOMAIN="${DOMAIN}"

# DNS zones
DNS_FORWARD_ZONE="${DOMAIN}"
DNS_REVERSE_ZONE="56.168.192.in-addr.arpa"

# -----------------------------------------------------------------------------
# DHCP Configuration
# -----------------------------------------------------------------------------
DHCP_SERVER="${DHCP1_IP}"
DHCP_SUBNET="192.168.56.0"
DHCP_NETMASK="24"
DHCP_ROUTER="${HOST_IP}"
DHCP_DNS="${NS1_IP}"
DHCP_RANGE_START="192.168.56.100"
DHCP_RANGE_END="192.168.56.199"
DHCP_LEASE_TIME="3600"
DHCP_SERVICE_CN="demo-dhcp-service"

# -----------------------------------------------------------------------------
# Mail Server Configuration
# -----------------------------------------------------------------------------
MAIL1_IP="192.168.56.22"
MAIL1_MAC="08:00:27:00:00:22"
MAIL_DOMAIN="${DOMAIN}"
MAIL_SERVER="mail1.${DOMAIN}"
SMTP_PORT="25"
SMTPS_PORT="465"
SUBMISSION_PORT="587"
IMAP_PORT="143"
IMAPS_PORT="993"
MAIL_ADMIN="postmaster@${DOMAIN}"

# Virtual mailbox storage
VMAIL_UID="5000"
VMAIL_GID="5000"
VMAIL_HOME="/var/mail/vhosts"

# LDAP lookups for Postfix / Dovecot
# Use base DN (not ou=people) so users in departments are also found.
# The filters already restrict to objectClass=hrcMailAccount.
MAIL_LDAP_SEARCH_BASE="${LDAP_BASE_DN}"
MAIL_LDAP_MAILBOX_FILTER="(&(objectClass=hrcMailAccount)(mail=%s))"
MAIL_LDAP_ALIAS_FILTER="(&(objectClass=hrcMailAccount)(hrcMailAlternateAddress=%s))"
MAIL_LDAP_FORWARD_FILTER="(&(objectClass=hrcMailAccount)(mail=%s)(hrcMailForwardingAddress=*))"
MAIL_LDAP_GROUP_FILTER="(&(objectClass=hrcGroupMail)(mail=%s))"

# TLS certificates (self-signed, generated during provisioning)
MAIL_TLS_CERT="/etc/ssl/certs/heracles.local.crt"
MAIL_TLS_KEY="/etc/ssl/private/heracles.local.key"

# Dev PKI sources (from host)
DEV_CA_CERT_SOURCE="/vagrant/config/ca/heracles-dev-ca.crt"
DEV_TLS_CERT_SOURCE="/vagrant/config/certs/heracles.local.crt"
DEV_TLS_KEY_SOURCE="/vagrant/config/certs/heracles.local.key"

# -----------------------------------------------------------------------------
# SSSD Configuration
# -----------------------------------------------------------------------------
SSSD_CACHE_TIMEOUT="600"
SSSD_ENUM_CACHE_TIMEOUT="120"

# -----------------------------------------------------------------------------
# VM Configuration
# -----------------------------------------------------------------------------
VAGRANT_BOX="debian/bookworm64"
VAGRANT_BOX_VERSION="12.20240905.1"

VM_MEMORY_NS1="512"
VM_MEMORY_DHCP1="512"
VM_MEMORY_MAIL1="1024"
VM_MEMORY_SERVER="1024"
VM_MEMORY_WORKSTATION="1024"
VM_CPUS="1"

# -----------------------------------------------------------------------------
# Demo Users (for reference, created via API)
# -----------------------------------------------------------------------------
# testuser - Full access to all systems
# devuser  - Access restricted to server1 only
# adminuser - Admin with sudo privileges

# -----------------------------------------------------------------------------
# Helper function to export all variables
# -----------------------------------------------------------------------------
export_all_config() {
    export HOST_IP NS1_IP DHCP1_IP MAIL1_IP MAIL1_MAC SERVER1_IP WORKSTATION1_IP DOMAIN
    export LDAP_HOST LDAP_PORT LDAP_URI
    export LDAP_CA_CERT
    export LDAP_BASE_DN LDAP_USERS_DN LDAP_GROUPS_DN LDAP_SYSTEMS_DN LDAP_SUDOERS_DN LDAP_DNS_DN LDAP_DHCP_DN
    export LDAP_ADMIN_DN LDAP_ADMIN_PASSWORD LDAP_BIND_DN LDAP_BIND_PASSWORD
    export DNS_SERVER DNS_FORWARDER DNS_SEARCH_DOMAIN DNS_FORWARD_ZONE DNS_REVERSE_ZONE
    export DHCP_SERVER DHCP_SUBNET DHCP_NETMASK DHCP_ROUTER DHCP_DNS
    export DHCP_RANGE_START DHCP_RANGE_END DHCP_LEASE_TIME DHCP_SERVICE_CN
    export MAIL1_IP MAIL_DOMAIN MAIL_SERVER SMTP_PORT SMTPS_PORT SUBMISSION_PORT IMAP_PORT IMAPS_PORT MAIL_ADMIN
    export VMAIL_UID VMAIL_GID VMAIL_HOME
    export MAIL_LDAP_SEARCH_BASE MAIL_LDAP_MAILBOX_FILTER MAIL_LDAP_ALIAS_FILTER MAIL_LDAP_FORWARD_FILTER MAIL_LDAP_GROUP_FILTER
    export MAIL_TLS_CERT MAIL_TLS_KEY
    export DEV_CA_CERT_SOURCE DEV_TLS_CERT_SOURCE DEV_TLS_KEY_SOURCE
    export SSSD_CACHE_TIMEOUT SSSD_ENUM_CACHE_TIMEOUT
}
