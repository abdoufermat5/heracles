# Alembic Migrations

This directory contains database migrations for the Heracles API.

## Quick Reference

### Running Migrations (inside container)

```bash
# Upgrade to latest version
docker compose exec api alembic upgrade head

# Upgrade to a specific revision
docker compose exec api alembic upgrade 0001

# Downgrade one revision
docker compose exec api alembic downgrade -1

# Downgrade to specific revision
docker compose exec api alembic downgrade 0001

# Show current revision
docker compose exec api alembic current

# Show migration history
docker compose exec api alembic history

# Show pending migrations
docker compose exec api alembic history --indicate-current
```

### Creating New Migrations

```bash
# Create a new migration (manual)
docker compose exec api alembic revision -m "add_user_preferences"

# Create migration from model changes (autogenerate)
docker compose exec api alembic revision --autogenerate -m "add_user_preferences"
```

### Best Practices

1. **Always test migrations** in development before production
2. **Include both upgrade and downgrade** operations
3. **Use descriptive revision messages** that explain the change
4. **Review autogenerated migrations** before running them
5. **Back up your database** before running migrations in production

## Migration File Structure

Each migration file contains:

```python
"""Description of the migration

Revision ID: xxxx
Revises: yyyy (previous revision)
Create Date: 2025-01-31 12:00:00

"""

def upgrade() -> None:
    # Operations to apply the migration
    pass

def downgrade() -> None:
    # Operations to reverse the migration
    pass
```

## Environment Variables

The following environment variables configure database connection:

- `POSTGRES_HOST` - Database host (default: `localhost`)
- `POSTGRES_PORT` - Database port (default: `5432`)
- `POSTGRES_DB` - Database name (default: `heracles`)
- `POSTGRES_USER` - Database user (default: `heracles`)
- `POSTGRES_PASSWORD` - Database password (default: `heracles`)
